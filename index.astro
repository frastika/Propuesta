---
const hearts = Array.from({ length: 22 }, (_, i) => ({
  x: 4 + i * 4.2,
  delay: (i * 0.45).toFixed(2),
  duration: (8.5 + (i % 6) * 1.25).toFixed(2),
  drift: ((i % 5) - 2) * 0.9,
  size: (0.7 + (i % 4) * 0.15).toFixed(2),
}));

const briWords = Array.from({ length: 24 }, (_, i) => ({
  x: 2 + (i % 6) * 19 + (i % 2) * 2,
  y: 4 + Math.floor(i / 6) * 24,
  delay: (i * 0.9).toFixed(2),
  duration: (8 + (i % 5) * 1.1).toFixed(2),
  rotate: ((i % 4) - 1.5) * 2,
}));
---

<head>
  <title>Hola Bri</title>
</head>

<main class="page">
  <div class="bg-glow"></div>
  <div class="phrase-layer" id="phrase-layer" aria-hidden="true"></div>

  <div class="floating-hearts" aria-hidden="true">
    {hearts.map((heart) => (
      <span
        class="heart"
        style={`--x:${heart.x}%; --delay:${heart.delay}s; --duration:${heart.duration}s; --drift:${heart.drift}rem; --size:${heart.size}rem;`}
      ></span>
    ))}
  </div>

  <div class="bri-layer" aria-hidden="true">
    {briWords.map((word) => (
      <span
        class="bri"
        style={`--x:${word.x}%; --y:${word.y}%; --delay:${word.delay}s; --duration:${word.duration}s; --tilt:${word.rotate}deg;`}
      >
        BRI
      </span>
    ))}
  </div>

  <section class="stage" id="stage">
    <article class="card prompt-card" id="prompt-card">
      <p class="eyebrow">Hola preciosa, estaba pensando preguntarte si</p>
      <h1>Quieres ser mi san valentin?</h1>
      <p class="message">Te juro que la vamos a pasar bien</p>

      <div class="actions">
        <button id="yes-btn" class="btn btn-yes" type="button">Yes</button>
        <button id="no-btn" class="btn btn-no" type="button">No</button>
      </div>
    </article>

    <article class="card result-card" id="result-card" aria-live="polite">
      <p class="eyebrow"></p>
      <h2 id="result-title"></h2>
      <p class="message" id="result-message">Hola</p>
    </article>
  </section>
</main>

<script>
  const stage = document.getElementById("stage");
  const promptCard = document.getElementById("prompt-card");
  const resultCard = document.getElementById("result-card");
  const resultTitle = document.getElementById("result-title");
  const resultMessage = document.getElementById("result-message");
  const yesBtn = document.getElementById("yes-btn");
  const noBtn = document.getElementById("no-btn");

  let locked = false;

  function playSequence(choice, clickedButton, otherButton) {
    if (locked) return;
    locked = true;

    clickedButton?.classList.add("is-destroying");
    otherButton?.classList.add("is-dimmed");

    if (yesBtn) yesBtn.disabled = true;
    if (noBtn) noBtn.disabled = true;

    setTimeout(() => {
      promptCard?.classList.add("is-falling");
    }, 520);

    setTimeout(() => {
      if (resultCard) {
        resultCard.classList.remove("for-yes", "for-no");
        resultCard.classList.add(choice === "yes" ? "for-yes" : "for-no");
      }

      if (choice === "yes") {
        if (resultTitle) resultTitle.textContent = "I knew you'd accept. See you tonight, love.";
        if (resultMessage) {
          resultMessage.textContent = "";
        }
      } else {
        if (resultTitle) resultTitle.textContent = "That's ok, maybe we'll have a good time later, Goodbye.";
        if (resultMessage) {
          resultMessage.textContent = " ";
        }
      }

      stage?.classList.add("show-result");
    }, 1400);
  }

  yesBtn?.addEventListener("click", () => {
    playSequence("yes", yesBtn, noBtn);
  });

  noBtn?.addEventListener("click", (event) => {
    event.preventDefault();
    event.stopPropagation();
  });
</script>

<style>
  @import url("https://fonts.googleapis.com/css2?family=Great+Vibes&family=Playfair+Display:wght@500;700;800&family=Manrope:wght@400;600;700&display=swap");

  :root {
    --pink-900: #64103a;
    --pink-700: #9a1459;
    --pink-500: #df3c94;
  }

  * {
    box-sizing: border-box;
  }

  body {
    margin: 0;
    min-height: 100vh;
    font-family: "Manrope", sans-serif;
    color: var(--pink-900);
  }

  .page {
    position: relative;
    min-height: 100vh;
    overflow: hidden;
    display: grid;
    place-items: center;
    padding: 1.5rem;
    background:
      radial-gradient(circle at 20% 16%, #ffd9ed 0%, transparent 40%),
      radial-gradient(circle at 80% -4%, #ffcae5 0%, transparent 43%),
      linear-gradient(160deg, #fff8fc 0%, #ffe7f3 56%, #ffd9eb 100%);
  }

  .bg-glow {
    position: absolute;
    width: min(88vw, 48rem);
    aspect-ratio: 1 / 1;
    border-radius: 999px;
    background: rgba(255, 98, 182, 0.24);
    filter: blur(88px);
    z-index: 0;
  }

  .floating-hearts,
  .bri-layer {
    position: absolute;
    inset: 0;
    pointer-events: none;
    z-index: 1;
  }

  .phrase-layer {
    position: absolute;
    inset: 0;
    pointer-events: none;
    z-index: 2;
    overflow: hidden;
    opacity: 0;
    transition: opacity 0.35s ease;
  }

  .phrase-layer.is-active {
    opacity: 1;
  }

  .heart {
    position: absolute;
    left: var(--x);
    bottom: -2rem;
    width: var(--size);
    height: var(--size);
    border-radius: 0.15rem;
    transform: rotate(45deg);
    opacity: 0;
    background: linear-gradient(145deg, #ff4eaa, #ff8fca);
    animation: rise var(--duration) var(--delay) infinite linear;
  }

  .heart::before,
  .heart::after {
    content: "";
    position: absolute;
    width: 100%;
    height: 100%;
    border-radius: 999px;
    background: inherit;
  }

  .heart::before {
    left: -50%;
  }

  .heart::after {
    top: -50%;
  }

  .bri {
    position: absolute;
    left: var(--x);
    top: var(--y);
    font: 800 clamp(2rem, 7vw, 5rem) "Playfair Display", serif;
    letter-spacing: 0.2em;
    color: rgba(150, 12, 78, 0.2);
    text-shadow: 0 0 12px rgba(255, 201, 229, 0.28);
    transform: rotate(var(--tilt));
    opacity: 0;
    animation: briFadeFloat var(--duration) var(--delay) infinite ease-in-out;
  }

  .stage {
    position: relative;
    width: min(94vw, 48rem);
    min-height: min(80vh, 44rem);
    display: grid;
    place-items: center;
    z-index: 5;
    perspective: 1300px;
  }

  .card {
    position: absolute;
    width: min(94vw, 46rem);
    border-radius: 2.25rem;
    padding: clamp(2rem, 4vw, 3rem);
    text-align: center;
    background: linear-gradient(160deg, rgba(255, 255, 255, 0.76), rgba(255, 232, 245, 0.92));
    border: 1px solid rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(14px);
    box-shadow:
      0 30px 74px rgba(160, 20, 90, 0.22),
      inset 0 1px 0 rgba(255, 255, 255, 0.85);
  }

  .prompt-card {
    transform-origin: center;
    transition: opacity 0.5s ease;
  }

  .prompt-card.is-falling {
    animation: cardFall 1s forwards cubic-bezier(0.22, 1, 0.36, 1);
  }

  .result-card {
    opacity: 0;
    transform: translateY(3.8rem) scale(0.92) rotateX(14deg);
    pointer-events: none;
  }

  .stage.show-result .result-card {
    animation: resultIn 0.9s 0.1s forwards cubic-bezier(0.22, 1, 0.36, 1);
  }

  .result-card.for-yes {
    box-shadow:
      0 34px 78px rgba(187, 26, 107, 0.3),
      inset 0 1px 0 rgba(255, 255, 255, 0.85);
  }

  .result-card.for-no {
    box-shadow:
      0 28px 70px rgba(128, 53, 91, 0.2),
      inset 0 1px 0 rgba(255, 255, 255, 0.85);
  }

  .eyebrow {
    margin: 0;
    letter-spacing: 0.13em;
    text-transform: uppercase;
    font-size: 0.82rem;
    font-weight: 700;
    color: var(--pink-700);
  }

  h1,
  h2 {
    margin: 0.85rem 0 0;
    font-family: "Playfair Display", serif;
    font-weight: 700;
    line-height: 1.15;
    color: #7e0f46;
  }

  h1 {
    font-size: clamp(2rem, 5vw, 3.4rem);
  }

  h2 {
    font-size: clamp(2.2rem, 5.2vw, 3.6rem);
  }

  .message {
    margin: 1rem auto 0;
    max-width: 36ch;
    line-height: 1.6;
    font-size: clamp(1.08rem, 2.4vw, 1.3rem);
    color: #7f1d4f;
  }

  .actions {
    margin-top: 1.9rem;
    display: flex;
    justify-content: center;
    gap: 1rem;
    flex-wrap: wrap;
  }

  .btn {
    position: relative;
    overflow: hidden;
    border: 0;
    border-radius: 999px;
    min-width: 10rem;
    padding: 0.86rem 1.8rem;
    font-size: 1rem;
    font-weight: 700;
    cursor: pointer;
    transition: transform 0.25s ease, opacity 0.25s ease;
  }

  .btn:hover {
    transform: translateY(-3px);
  }

  .btn-yes {
    color: #fff;
    background: linear-gradient(130deg, #ff49a7, #ff76be);
    box-shadow: 0 11px 24px rgba(209, 35, 115, 0.36);
  }

  .btn-no {
    color: #8c2455;
    background: rgba(255, 255, 255, 0.86);
    border: 1px solid rgba(220, 91, 153, 0.45);
    box-shadow: 0 9px 22px rgba(156, 38, 95, 0.13);
  }

  .btn-no.is-escaping {
    position: fixed;
    z-index: 25;
    min-width: 10rem;
    width: auto;
    transition:
      left 0.9s cubic-bezier(0.2, 0.85, 0.18, 1),
      top 0.9s cubic-bezier(0.2, 0.85, 0.18, 1),
      transform 0.3s ease;
  }

  .btn.is-dimmed {
    opacity: 0.36;
    transform: scale(0.98);
  }

  .btn.is-destroying {
    animation: buttonDestroy 0.7s forwards cubic-bezier(0.22, 1, 0.36, 1);
  }

  .btn.is-destroying::after {
    content: "";
    position: absolute;
    inset: -20%;
    border-radius: inherit;
    background: radial-gradient(circle, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0) 62%);
    animation: blast 0.7s forwards;
  }

  .bg-phrase {
    position: absolute;
    font-family: "Great Vibes", cursive;
    font-size: clamp(1.2rem, 2.7vw, 2.15rem);
    color: rgba(128, 18, 77, 0.4);
    letter-spacing: 0.015em;
    text-shadow: 0 0 12px rgba(255, 210, 234, 0.36);
    opacity: 0;
    white-space: nowrap;
    animation-name: phraseFloat;
    animation-timing-function: ease-out;
    animation-fill-mode: forwards;
  }

  @keyframes rise {
    0% {
      transform: translate3d(0, 0, 0) scale(0.75) rotate(45deg);
      opacity: 0;
    }
    12% {
      opacity: 0.72;
    }
    100% {
      transform: translate3d(var(--drift), -118vh, 0) scale(1.3) rotate(45deg);
      opacity: 0;
    }
  }

  @keyframes briFadeFloat {
    0% {
      transform: translate3d(0, 1.1rem, 0) rotate(var(--tilt)) scale(0.94);
      opacity: 0;
    }
    22% {
      opacity: 0.26;
    }
    62% {
      transform: translate3d(0, -0.8rem, 0) rotate(calc(var(--tilt) + 1deg)) scale(1.03);
      opacity: 0.18;
    }
    100% {
      transform: translate3d(0, -1.4rem, 0) rotate(calc(var(--tilt) + 2deg)) scale(1.04);
      opacity: 0;
    }
  }

  @keyframes buttonDestroy {
    0% {
      transform: scale(1);
      opacity: 1;
      filter: blur(0);
    }
    45% {
      transform: scale(1.15) rotate(-2deg);
      opacity: 1;
      filter: blur(0);
    }
    100% {
      transform: scale(0.32) rotate(14deg);
      opacity: 0;
      filter: blur(4px);
    }
  }

  @keyframes blast {
    from {
      transform: scale(0.2);
      opacity: 0.9;
    }
    to {
      transform: scale(1.7);
      opacity: 0;
    }
  }

  @keyframes cardFall {
    0% {
      opacity: 1;
      transform: translateY(0) rotateX(0) rotateZ(0) scale(1);
    }
    60% {
      opacity: 1;
      transform: translateY(7rem) rotateX(26deg) rotateZ(3deg) scale(0.98);
    }
    100% {
      opacity: 0;
      transform: translateY(20rem) rotateX(48deg) rotateZ(7deg) scale(0.86);
    }
  }

  @keyframes resultIn {
    0% {
      opacity: 0;
      transform: translateY(4rem) scale(0.92) rotateX(12deg);
    }
    70% {
      opacity: 1;
      transform: translateY(-0.5rem) scale(1.02) rotateX(0);
    }
    100% {
      opacity: 1;
      transform: translateY(0) scale(1) rotateX(0);
    }
  }

  @keyframes phraseFloat {
    from {
      opacity: 0;
      transform: translate3d(0, 0.8rem, 0) scale(0.96);
    }
    25% {
      opacity: 0.75;
    }
    100% {
      opacity: 0;
      transform: translate3d(var(--drift-x), var(--drift-y), 0) scale(1.05);
    }
  }

  @media (max-width: 40rem) {
    .card {
      border-radius: 1.6rem;
      width: min(95vw, 46rem);
      padding: 1.5rem;
    }

    .btn {
      width: 100%;
    }
  }
</style>
